<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="学者,践行者,php" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.2" />






<meta name="description" content="终生学习者，实践者，践行渐远。">
<meta property="og:type" content="website">
<meta property="og:title" content="学者">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="学者">
<meta property="og:description" content="终生学习者，实践者，践行渐远。">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="学者">
<meta name="twitter:description" content="终生学习者，实践者，践行渐远。">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/page/2/"/>


  <title> 学者 </title>
</head>

<body itemscope itemtype="//schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="//schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">学者</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/16/科普-类的反射/" itemprop="url">
                  科普-类的反射
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-16T15:04:32+08:00" content="2016-07-16">
              2016-07-16
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/16/科普-类的反射/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/16/科普-类的反射/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>听着有点吓人，熟悉之后觉得有点对不起人。平常的业务编程中很少用到，基本上只有框架才会用的到。</p>
<blockquote>
<p>解析：反射其实就是获取类的信息（把类也看成是对象，然后通过反射类获取这个对象的一些属性）</p>
</blockquote>
          <div class="post-more-link text-center">
            <a class="btn" href="/2016/07/16/科普-类的反射/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/15/apache工作模式-prefork、worker/" itemprop="url">
                  apache工作模式解读-prefork、worker
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-15T22:18:32+08:00" content="2016-07-15">
              2016-07-15
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/15/apache工作模式-prefork、worker/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/15/apache工作模式-prefork、worker/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h3 id="prefork模式"><a href="#prefork模式" class="headerlink" title="prefork模式"></a>prefork模式</h3><p>这个多路处理模块(MPM)实现了一个非线程型的、预派生的web服务器，它的工作方式类似于Apache 1.3。它适合于没有线程安全库，需要避免线程兼容性问题的系统。它是要求将每个请求相互独立的情况下最好的MPM，这样若一个请求出现问题就不会影响到其他请求。</p>
<p>这个MPM具有很强的自我调节能力，只需要很少的配置指令调整。最重要的是将MaxClients设置为一个足够大的数值以处理潜在的请求高峰，同时又不能太大，以致需要使用的内存超出物理内存的大小。</p>
          <div class="post-more-link text-center">
            <a class="btn" href="/2016/07/15/apache工作模式-prefork、worker/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/13/PHP｜什么是CGI, FastCGI, PHP-CGI, PHP-FPM, Spawn-FCGI/" itemprop="url">
                  PHP｜什么是CGI, FastCGI, PHP-CGI, PHP-FPM, Spawn-FCGI
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-13T22:18:32+08:00" content="2016-07-13">
              2016-07-13
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/13/PHP｜什么是CGI, FastCGI, PHP-CGI, PHP-FPM, Spawn-FCGI/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/13/PHP｜什么是CGI, FastCGI, PHP-CGI, PHP-FPM, Spawn-FCGI/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h3 id="什么是CGI"><a href="#什么是CGI" class="headerlink" title="什么是CGI"></a>什么是CGI</h3><p>CGI全称是“公共网关接口”(Common Gateway Interface)，HTTP服务器与你的或其它机器上的程序进行“交谈”的一种工具，其程序须运行在网络服务器上。</p>
<p>CGI可以用任何一种语言编写，只要这种语言具有标准输入、输出和环境变量。如php,perl,tcl等</p>
          <div class="post-more-link text-center">
            <a class="btn" href="/2016/07/13/PHP｜什么是CGI, FastCGI, PHP-CGI, PHP-FPM, Spawn-FCGI/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/08/thinkphp中的行为扩展和插件机制解读/" itemprop="url">
                  thinkphp中的行为扩展和插件机制解读
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-08T15:58:11+08:00" content="2016-06-08">
              2016-06-08
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/08/thinkphp中的行为扩展和插件机制解读/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/08/thinkphp中的行为扩展和插件机制解读/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>在立即行为扩展和插件机制之前必须先来了解另外一个知识点。</p>
<h3 id="什么是钩子？"><a href="#什么是钩子？" class="headerlink" title="什么是钩子？"></a>什么是钩子？</h3><p>就像我们的房间，柜子上或者门上总有那么一个钩子，它的作用很明显，能够挂东西。我们可以挂上一个包包，或者一件衣服，或者一条耳机线。当你不想要某个挂件、衣服时，取下来即可。并不会破坏原有的袋子或者衣服的功能。<br>你挂与不挂，钩子就在那里。<br>回归到我们的程序，里面的钩子也是同样的理解。我们在程序中放了一个钩子，可以挂上某些轻量级单一的功能。例如加个统计，或者发个邮件，或者挂上一个编辑器。再回归正题，献上代码。</p>
          <div class="post-more-link text-center">
            <a class="btn" href="/2016/06/08/thinkphp中的行为扩展和插件机制解读/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/10/设计模式六大原则/" itemprop="url">
                  设计模式六大原则
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-10T21:08:48+08:00" content="2016-05-10">
              2016-05-10
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/10/设计模式六大原则/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/10/设计模式六大原则/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h3 id="一、单一职责原则（SRP）"><a href="#一、单一职责原则（SRP）" class="headerlink" title="一、单一职责原则（SRP）"></a>一、单一职责原则（SRP）</h3><blockquote>
<p>SRP原话解释：There should never be more than one reason for a class to<br>change.</p>
</blockquote>
<p>好处：<br>1.类的复杂性降低，实现什么职责都有清晰明确的定义。<br>2.可读性提高。<br>3.可维护性提高。<br>4.变更引起的风险降低。变更是必不可少的，如果接口是单一职责做得好，一个接口修改只对相应的实现类有影响，对其他的接口无影响，这对系统的扩展性、维护性都有非常大的帮助。</p>
<p>remarks:单一职责原则提出了一个编写程序的标准，用“职责”或“变化原因”来衡量接口或类设计得是否优良，但是“职责”和“变化原因”都是不可度量的，因项目而异，因环境而异。</p>
<p>对于单一职责原则，建议接口一定要做到单一职责，类的设计尽量做到只有一个原因引起变化。<br>
          <div class="post-more-link text-center">
            <a class="btn" href="/2016/05/10/设计模式六大原则/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/27/PHP 底层的运行机制与原理/" itemprop="url">
                  PHP 底层的运行机制与原理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-04-27T20:08:11+08:00" content="2016-04-27">
              2016-04-27
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/04/27/PHP 底层的运行机制与原理/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/27/PHP 底层的运行机制与原理/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>PHP说简单，但是要精通也不是一件简单的事。我们除了会使用之外，还得知道它底层的工作原理。</p>
<p>PHP是一种适用于web开发的动态语言。具体点说，就是一个用C语言实现包含大量组件的软件框架。更狭义点看，可以把它认为是一个强大的UI框架。</p>
<p>了解PHP底层实现的目的是什么？动态语言要像用好首先得了解它，内存管理、框架模型值得我们借鉴，通过扩展开发实现更多更强大的功能，优化我们程序的性能。</p>
<h3 id="1-PHP的设计理念及特点"><a href="#1-PHP的设计理念及特点" class="headerlink" title="1. PHP的设计理念及特点"></a>1. PHP的设计理念及特点</h3><p>多进程模型：由于PHP是多进程模型，不同请求间互不干涉，这样保证了一个请求挂掉不会对全盘服务造成影响，当然，随着时代发展，PHP也早已支持多线程模型。<br>弱类型语言：和C/C++、Java、C#等语言不同，PHP是一门弱类型语言。一个变量的类型并不是一开始就确定不变，运行中才会确定并可能发生隐式或显式的类型转换，这种机制的灵活性在web开发中非常方便、高效，具体会在后面PHP变量中详述。<br>引擎(Zend)+组件(ext)的模式降低内部耦合。<br>中间层(sapi)隔绝web server和PHP。<br>语法简单灵活，没有太多规范。缺点导致风格混杂，但再差的程序员也不会写出太离谱危害全局的程序。</p>
<h3 id="2-PHP的四层体系"><a href="#2-PHP的四层体系" class="headerlink" title="2. PHP的四层体系"></a>2. PHP的四层体系</h3><p>PHP的核心架构如下图：<br><img src="http://7xiwze.com1.z0.glb.clouddn.com/2011_09_20_01.jpg" alt="请输入图片描述"></p>
<p>从图上可以看出，PHP从下到上是一个4层体系：</p>
<p>Zend引擎：Zend整体用纯C实现，是PHP的内核部分，它将PHP代码翻译（词法、语法解析等一系列编译过程）为可执行opcode的处理并实现相应的处理方法、实现了基本的数据结构（如hashtable、oo）、内存分配及管理、提供了相应的api方法供外部调用，是一切的核心，所有的外围功能均围绕Zend实现。<br>Extensions：围绕着Zend引擎，extensions通过组件式的方式提供各种基础服务，我们常见的各种内置函数（如array系列）、标准库等都是通过extension来实现，用户也可以根据需要实现自己的extension以达到功能扩展、性能优化等目的（如贴吧正在使用的PHP中间层、富文本解析就是extension的典型应用）。<br>Sapi：Sapi全称是Server Application Programming Interface，也就是服务端应用编程接口，Sapi通过一系列钩子函数，使得PHP可以和外围交互数据，这是PHP非常优雅和成功的一个设计，通过sapi成功的将PHP本身和上层应用解耦隔离，PHP可以不再考虑如何针对不同应用进行兼容，而应用本身也可以针对自己的特点实现不同的处理方式。<br>上层应用：这就是我们平时编写的PHP程序，通过不同的sapi方式得到各种各样的应用模式，如通过webserver实现web应用、在命令行下以脚本方式运行等等。<br>如果PHP是一辆车，那么车的框架就是PHP本身，Zend是车的引擎（发动机），Ext下面的各种组件就是车的轮子，Sapi可以看做是公路，车可以跑在不同类型的公路上，而一次PHP程序的执行就是汽车跑在公路上。因此，我们需要：性能优异的引擎+合适的车轮+正确的跑道。</p>
<h3 id="3-Sapi"><a href="#3-Sapi" class="headerlink" title="3. Sapi"></a>3. Sapi</h3><p>如前所述，Sapi通过通过一系列的接口，使得外部应用可以和PHP交换数据并可以根据不同应用特点实现特定的处理方法，我们常见的一些sapi有：</p>
<p>apache2handler：这是以apache作为webserver，采用mod_PHP模式运行时候的处理方式，也是现在应用最广泛的一种。</p>
<p>cgi：这是webserver和PHP直接的另一种交互方式，也就是大名鼎鼎的fastcgi协议，在最近今年fastcgi+PHP得到越来越多的应用，也是异步webserver所唯一支持的方式。</p>
<p>cli：命令行调用的应用模式</p>
<h3 id="4-PHP的执行流程-amp-opcode"><a href="#4-PHP的执行流程-amp-opcode" class="headerlink" title="4. PHP的执行流程&amp;opcode"></a>4. PHP的执行流程&amp;opcode</h3><p>我们先来看看PHP代码的执行所经过的流程。<br><img src="http://7xiwze.com1.z0.glb.clouddn.com/2011_09_20_02.jpg" alt="请输入图片描述"></p>
<p>从图上可以看到，PHP实现了一个典型的动态语言执行过程：拿到一段代码后，经过词法解析、语法解析等阶段后，源程序会被翻译成一个个指令(opcodes)，然后ZEND虚拟机顺次执行这些指令完成操作。PHP本身是用C实现的，因此最终调用的也都是C的函数，实际上，我们可以把PHP看做是一个C开发的软件。</p>
<p>PHP的执行的核心是翻译出来的一条一条指令，也即opcode。</p>
<p>Opcode是PHP程序执行的最基本单位。一个opcode由两个参数(op1,op2)、返回值和处理函数组成。PHP程序最终被翻译为一组opcode处理函数的顺序执行。</p>
<p>常见的几个处理函数：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">ZEND_ASSIGN_SPEC_CV_CV_HANDLER : 变量分配 （$a=$b）</div><div class="line">ZEND_DO_FCALL_BY_NAME_SPEC_HANDLER：函数调用</div><div class="line">ZEND_CONCAT_SPEC_CV_CV_HANDLER：字符串拼接 $a.$b</div><div class="line">ZEND_ADD_SPEC_CV_CONST_HANDLER: 加法运算 $a+<span class="number">2</span></div><div class="line">ZEND_IS_EQUAL_SPEC_CV_CONST：判断相等 $a==<span class="number">1</span></div><div class="line">ZEND_IS_IDENTICAL_SPEC_CV_CONST：判断相等 $a===<span class="number">1</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">### 5.HashTable — 核心数据结构</span></div><div class="line">HashTable是zend的核心数据结构，在PHP里面几乎并用来实现所有常见功能，我们知道的PHP数组即是其典型应用，此外，在zend内部，如函数符号表、全局变量等也都是基于hash table来实现。</div><div class="line"></div><div class="line">PHP的hash table具有如下特点：</div><div class="line"></div><div class="line">支持典型的key-&gt;value查询</div><div class="line">可以当做数组使用</div><div class="line">添加、删除节点是O（<span class="number">1</span>）复杂度</div><div class="line">key支持混合类型：同时存在关联数组合索引数组</div><div class="line">Value支持混合类型：<span class="keyword">array</span> (“string”,<span class="number">2332</span>)</div><div class="line">支持线性遍历：如<span class="keyword">foreach</span></div><div class="line">Zend hash table实现了典型的hash表散列结构，同时通过附加一个双向链表，提供了正向、反向遍历数组的功能。其结构如下图：</div><div class="line">![请输入图片描述][<span class="number">3</span>]</div><div class="line"></div><div class="line">可以看到，在hash table中既有key-&gt;value形式的散列结构，也有双向链表模式，使得它能够非常方便的支持快速查找和线性遍历。</div><div class="line"></div><div class="line">散列结构：Zend的散列结构是典型的hash表模型，通过链表的方式来解决冲突。需要注意的是zend的hash table是一个自增长的数据结构，当hash表数目满了之后，其本身会动态以<span class="number">2</span>倍的方式扩容并重新元素位置。初始大小均为<span class="number">8</span>。另外，在进行key-&gt;value快速查找时候，zend本身还做了一些优化，通过空间换时间的方式加快速度。比如在每个元素中都会用一个变量nKeyLength标识key的长度以作快速判定。</div><div class="line">双向链表：Zend hash table通过一个链表结构，实现了元素的线性遍历。理论上，做遍历使用单向链表就够了，之所以使用双向链表，主要目的是为了快速删除，避免遍历。Zend hash table是一种复合型的结构，作为数组使用时，即支持常见的关联数组也能够作为顺序索引数字来使用，甚至允许<span class="number">2</span>者的混合。</div><div class="line">PHP关联数组：关联数组是典型的hash_table应用。一次查询过程经过如下几步（从代码可以看出，这是一个常见的hash查询过程并增加一些快速判定加速查找。）：</div><div class="line">``` php</div><div class="line">getKeyHashValue h;</div><div class="line">index = n &amp; nTableMask;</div><div class="line">Bucket *p = arBucket[index];</div><div class="line"><span class="keyword">while</span> (p) &#123;</div><div class="line">    <span class="keyword">if</span> ((p-&gt;h == h) &amp;&amp; (p-&gt;nKeyLength == nKeyLength)) &#123;</div><div class="line">        <span class="keyword">RETURN</span> p-&gt;data;  </div><div class="line">    &#125;</div><div class="line">    p=p-&gt;next;</div><div class="line">&#125;</div><div class="line"><span class="keyword">RETURN</span> FALTURE;</div></pre></td></tr></table></figure></p>
<p>PHP索引数组：索引数组就是我们常见的数组，通过下标访问。例如 $arr[0]，Zend HashTable内部进行了归一化处理，对于index类型key同样分配了hash值和nKeyLength(为0)。内部成员变量nNextFreeElement就是当前分配到的最大id，每次push后自动加一。正是这种归一化处理，PHP才能够实现关联和非关联的混合。由于push操作的特殊性，索引key在PHP数组中先后顺序并不是通过下标大小来决定，而是由push的先后决定。例如 $arr<a href="http://7xiwze.com1.z0.glb.clouddn.com/2011_09_20_01.jpg" target="_blank" rel="external">1</a> = 2; $arr<a href="http://7xiwze.com1.z0.glb.clouddn.com/2011_09_20_02.jpg" target="_blank" rel="external">2</a> = 3;对于double类型的key，Zend HashTable会将他当做索引key处理</p>
<h3 id="6-PHP变量"><a href="#6-PHP变量" class="headerlink" title="6. PHP变量"></a>6. PHP变量</h3><p>PHP是一门弱类型语言，本身不严格区分变量的类型。PHP在变量申明的时候不需要指定类型。PHP在程序运行期间可能进行变量类型的隐示转换。和其他强类型语言一样，程序中也可以进行显示的类型转换。PHP变量可以分为简单类型(int、string、bool)、集合类型(array resource object)和常量(const)。以上所有的变量在底层都是同一种结构 zval。</p>
<p>Zval是zend中另一个非常重要的数据结构，用来标识并实现PHP变量，其数据结构如下：<br><img src="http://7xiwze.com1.z0.glb.clouddn.com/2011_09_20_04.jpg" alt="请输入图片描述"></p>
<p>Zval主要由三部分组成：</p>
<p>type：指定了变量所述的类型（整数、字符串、数组等）<br>refcount&amp;is_ref：用来实现引用计数(后面具体介绍)<br>value：核心部分，存储了变量的实际数据<br>Zvalue是用来保存一个变量的实际数据。因为要存储多种类型，所以zvalue是一个union，也由此实现了弱类型。</p>
<p>PHP变量类型和其实际存储对应关系如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">IS_LONG   -&gt; lvalue</div><div class="line">IS_DOUBLE -&gt; dvalue</div><div class="line">IS_ARRAY  -&gt; ht</div><div class="line">IS_STRING -&gt; str</div><div class="line">IS_RESOURCE -&gt; lvalue</div></pre></td></tr></table></figure>
<p>引用计数在内存回收、字符串操作等地方使用非常广泛。PHP中的变量就是引用计数的典型应用。Zval的引用计数通过成员变量is_ref和ref_count实现，通过引用计数，多个变量可以共享同一份数据。避免频繁拷贝带来的大量消耗。</p>
<p>在进行赋值操作时，zend将变量指向相同的zval同时ref_count++，在unset操作时，对应的ref_count-1。只有ref_count减为0时才会真正执行销毁操作。如果是引用赋值，则zend会修改is_ref为1。</p>
<p>PHP变量通过引用计数实现变量共享数据，那如果改变其中一个变量值呢？当试图写入一个变量时，Zend若发现该变量指向的zval被多个变量共享，则为其复制一份ref_count为1的zval，并递减原zval的refcount，这个过程称为“zval分离”。可见，只有在有写操作发生时zend才进行拷贝操作，因此也叫copy-on-write(写时拷贝)</p>
<p>对于引用型变量，其要求和非引用型相反，引用赋值的变量间必须是捆绑的，修改一个变量就修改了所有捆绑变量。</p>
<p>整数、浮点数是PHP中的基础类型之一，也是一个简单型变量。对于整数和浮点数，在zvalue中直接存储对应的值。其类型分别是long和double。</p>
<p>从zvalue结构中可以看出，对于整数类型，和c等强类型语言不同，PHP是不区分int、unsigned int、long、long long等类型的，对它来说，整数只有一种类型也就是long。由此，可以看出，在PHP里面，整数的取值范围是由编译器位数来决定而不是固定不变的。</p>
<p>对于浮点数，类似整数，它也不区分float和double而是统一只有double一种类型。</p>
<p>在PHP中，如果整数范围越界了怎么办？这种情况下会自动转换为double类型，这个一定要小心，很多trick都是由此产生。</p>
<p>和整数一样，字符变量也是PHP中的基础类型和简单型变量。通过zvalue结构可以看出，在PHP中，字符串是由由指向实际数据的指针和长度结构体组成，这点和c++中的string比较类似。由于通过一个实际变量表示长度，和c不同，它的字符串可以是2进制数据（包含\0），同时在PHP中，求字符串长度strlen是O(1)操作。</p>
<p>在新增、修改、追加字符串操作时，PHP都会重新分配内存生成新的字符串。最后，出于安全考虑，PHP在生成一个字符串时末尾仍然会添加\0</p>
<p>常见的字符串拼接方式及速度比较：</p>
<p>假设有如下4个变量：$strA=‘123’; $strB = ‘456’; $intA=123; intB=456;</p>
<p>现在对如下的几种字符串拼接方式做一个比较和说明：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$res = $strA.$strB和$res = “$strA$strB” </div><div class="line">这种情况下，zend会重新malloc一块内存并进行相应处理，其速度一般</div><div class="line">$strA = $strA.$strB</div><div class="line">这种是速度最快的，zend会在当前strA基础上直接relloc，避免重复拷贝</div><div class="line">$res = $intA.$intB</div><div class="line">这种速度较慢，因为需要做隐式的格式转换，实际编写程序中也应该注意尽量避免</div><div class="line">$strA = sprintf (“%s%s”,$strA.$strB);</div></pre></td></tr></table></figure></p>
<p>这会是最慢的一种方式，因为sprintf在PHP中并不是一个语言结构，本身对于格式识别和处理就需要耗费比较多时间，另外本身机制也是malloc。不过sprintf的方式最具可读性，实际中可以根据具体情况灵活选择。<br>PHP的数组通过Zend HashTable来天然实现。</p>
<p>foreach操作如何实现？对一个数组的foreach就是通过遍历hashtable中的双向链表完成。对于索引数组，通过foreach遍历效率比for高很多，省去了key-&gt;value的查找。count操作直接调用HashTable-&gt;NumOfElements，O(1)操作。对于’123’这样的字符串，zend会转换为其整数形式。$arr[‘123’]和$arr[123]是等价的</p>
<p>资源类型变量是PHP中最复杂的一种变量，也是一种复合型结构。</p>
<p>PHP的zval可以表示广泛的数据类型，但是对于自定义的数据类型却很难充分描述。由于没有有效的方式描绘这些复合结构，因此也没有办法对它们使用传统的操作符。要解决这个问题，只需要通过一个本质上任意的标识符（label）引用指针，这种方式被称为资源。</p>
<p>在zval中，对于resource，lval作为指针来使用，直接指向资源所在的地址。Resource可以是任意的复合结构，我们熟悉的mysqli、fsock、memcached等都是资源。</p>
<p>如何使用资源：</p>
<p>注册：对于一个自定义的数据类型，要想将它作为资源。首先需要进行注册，zend会为它分配全局唯一标示。<br>获取一个资源变量：对于资源，zend维护了一个id-&gt;实际数据的hash_tale。对于一个resource，在zval中只记录了它的id。fetch的时候通过id在hash_table中找到具体的值返回。<br>资源销毁：资源的数据类型是多种多样的。Zend本身没有办法销毁它。因此需要用户在注册资源的时候提供销毁函数。当unset资源时，zend调用相应的函数完成析构。同时从全局资源表中删除它。<br>资源可以长期驻留，不只是在所有引用它的变量超出作用域之后，甚至是在一个请求结束了并且新的请求产生之后。这些资源称为持久资源，因为它们贯通SAPI的整个生命周期持续存在，除非特意销毁。很多情况下，持久化资源可以在一定程度上提高性能。比如我们常见的mysql_pconnect ,持久化资源通过pemalloc分配内存，这样在请求结束的时候不会释放。 对zend来说，对两者本身并不区分。</p>
<p>PHP中的局部变量和全局变量是如何实现的？对于一个请求，任意时刻PHP都可以看到两个符号表(symbol_table和active_symbol_table)，其中前者用来维护全局变量。后者是一个指针，指向当前活动的变量符号表，当程序进入到某个函数中时，zend就会为它分配一个符号表x同时将active_symbol_table指向a。通过这样的方式实现全局、局部变量的区分。</p>
<p>获取变量值：PHP的符号表是通过hash_table实现的，对于每个变量都分配唯一标识，获取的时候根据标识从表中找到相应zval返回。</p>
<p>函数中使用全局变量：在函数中，我们可以通过显式申明global来使用全局变量。在active_symbol_table中创建symbol_table中同名变量的引用，如果symbol_table中没有同名变量则会先创建。</p>
<p>原文出自：<a href="http://www.nowamagic.net/librarys/veda/detail/102" target="_blank" rel="external">http://www.nowamagic.net/librarys/veda/detail/102</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/16/我30多年的写作秘诀首次公开/" itemprop="url">
                  什么是守护进程？
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-04-16T18:25:32+08:00" content="2016-04-16">
              2016-04-16
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/读书/" itemprop="url" rel="index">
                    <span itemprop="name">读书</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/04/16/我30多年的写作秘诀首次公开/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/16/我30多年的写作秘诀首次公开/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>文/简书作者：樊荣强</p>
<p>2003年，我在广州《新经济》杂志当首席记者兼主笔，文章写得非常顺当，也是我这辈子最快乐的时光之一段。文章想怎么写就怎么写，杂志社老总都跟我发，而且还不必修改。在杂志社干了8个月，写了20万字的文章，后来结集为《珠江三角批判》出版，文章与书也引起不少的关注。这对一个作者来说，还有这么爽的事情吗？</p>
          <div class="post-more-link text-center">
            <a class="btn" href="/2016/04/16/我30多年的写作秘诀首次公开/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/09/探秘php多进程编程/" itemprop="url">
                  探秘php多进程编程
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-04-09T17:31:19+08:00" content="2016-04-09">
              2016-04-09
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/04/09/探秘php多进程编程/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/09/探秘php多进程编程/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本人小说迷，基本在线看先说，被弹窗，小人图等信息刺激太大，决心自己造个阅读器，采用php多进程爬虫技术来丰满自己的库，并邮件自动更新提醒。到这里，就先要探秘一下php的多进程编程。基于LINUX的PHP扩展PCNTL可以提供多进程编程。再探寻过程中，发现多进程的问题处理上重点关注几个方面：<br><strong>1控制进程数量</strong><br><strong>2处理潜在产生僵尸进程或孤儿进程</strong><br><strong>3父进程阻塞难以获得更大的并发效果</strong></p>
<blockquote>
<p>PCNTL原理:FORK,FORK编程的大概原理是，每次调用fork函数，操作系统就会产生一个子进程，儿子进程所有的堆栈信息都是原封不动复制父进程的，而在fork之后，父进程与子进程实际上是相互独立的，父子进程不会相互影响。也就是说，fork调用位置之前的所有变量，父进程和子进程是一样的，但fork之后则取决于各自的动作，且数据也是独立的；因为数据已经完整的复制给了子进程。而唯一能够区分父子进程的方法就是判断fork的返回值。如果为0，表示是子进程，如果为正数，表示为父进程，且该正数为子进程的PID（进程号），而如果是-1，表示子进程创建失败。</p>
</blockquote>
<h3 id="举个栗子-》1-直接方式：pcntl-php"><a href="#举个栗子-》1-直接方式：pcntl-php" class="headerlink" title="举个栗子=》1.直接方式：pcntl.php"></a>举个栗子=》1.直接方式：pcntl.php</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">echo</span> <span class="string">"parent start,pid"</span>.getmypid().<span class="string">"\n"</span>;</div><div class="line">        say();</div><div class="line">        <span class="keyword">for</span>($i=<span class="number">0</span>; $i&lt;<span class="number">3</span>; $i++)&#123;</div><div class="line">                $pid = pcntl_fork();</div><div class="line">                <span class="keyword">if</span>($pid==-<span class="string">"-1"</span>)&#123;</div><div class="line">                        <span class="keyword">die</span>(<span class="string">"fork fail"</span>);</div><div class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>($pid &gt; <span class="number">0</span>)&#123;</div><div class="line">                        <span class="keyword">echo</span> <span class="string">"parent here \n"</span>;</div><div class="line">                        <span class="keyword">for</span>($k=<span class="number">0</span>; $k&lt;<span class="number">2</span>; $k++)&#123;</div><div class="line">                                say();</div><div class="line">                        &#125;</div><div class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>($pid==<span class="string">"0"</span>)&#123;</div><div class="line">                        <span class="keyword">echo</span> <span class="string">"child here,my pid is "</span>.getmypid().<span class="string">"\n"</span>;</div><div class="line">                        <span class="keyword">for</span>($j=<span class="number">0</span>; $j&lt;<span class="number">5</span>; $j++)&#123;</div><div class="line">                                say();</div><div class="line">                        &#125;</div><div class="line">                        <span class="keyword">exit</span>;</div><div class="line">                &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">say</span><span class="params">()</span></span>&#123;</div><div class="line">                <span class="keyword">echo</span> getmypid().<span class="string">"\t"</span>.date(<span class="string">"y-m-d H:i:s"</span>,time()).<span class="string">"\n"</span>;</div><div class="line">                sleep(<span class="number">1</span>);</div><div class="line">        &#125;</div></pre></td></tr></table></figure>
<h4 id="结果："><a href="#结果：" class="headerlink" title="结果："></a>结果：</h4><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"># php -<span class="keyword">f</span> pcntl.php</div><div class="line">parent start,pid110614</div><div class="line"><span class="number">110614</span>  <span class="number">16</span>-<span class="number">08</span>-<span class="number">05</span> <span class="number">11</span>:<span class="number">54</span>:<span class="number">43</span></div><div class="line">parent here </div><div class="line"><span class="number">110614</span>  <span class="number">16</span>-<span class="number">08</span>-<span class="number">05</span> <span class="number">11</span>:<span class="number">54</span>:<span class="number">44</span></div><div class="line">child here,my pid <span class="keyword">is</span> <span class="number">110615</span></div><div class="line"><span class="number">110615</span>  <span class="number">16</span>-<span class="number">08</span>-<span class="number">05</span> <span class="number">11</span>:<span class="number">54</span>:<span class="number">44</span></div><div class="line"><span class="number">110614</span>  <span class="number">16</span>-<span class="number">08</span>-<span class="number">05</span> <span class="number">11</span>:<span class="number">54</span>:<span class="number">45</span></div><div class="line"><span class="number">110615</span>  <span class="number">16</span>-<span class="number">08</span>-<span class="number">05</span> <span class="number">11</span>:<span class="number">54</span>:<span class="number">45</span></div><div class="line">parent here </div><div class="line"><span class="number">110614</span>  <span class="number">16</span>-<span class="number">08</span>-<span class="number">05</span> <span class="number">11</span>:<span class="number">54</span>:<span class="number">46</span></div><div class="line"><span class="number">110615</span>  <span class="number">16</span>-<span class="number">08</span>-<span class="number">05</span> <span class="number">11</span>:<span class="number">54</span>:<span class="number">46</span></div><div class="line">child here,my pid <span class="keyword">is</span> <span class="number">110616</span></div><div class="line"><span class="number">110616</span>  <span class="number">16</span>-<span class="number">08</span>-<span class="number">05</span> <span class="number">11</span>:<span class="number">54</span>:<span class="number">46</span></div><div class="line"><span class="number">110614</span>  <span class="number">16</span>-<span class="number">08</span>-<span class="number">05</span> <span class="number">11</span>:<span class="number">54</span>:<span class="number">47</span></div><div class="line"><span class="number">110615</span>  <span class="number">16</span>-<span class="number">08</span>-<span class="number">05</span> <span class="number">11</span>:<span class="number">54</span>:<span class="number">47</span></div><div class="line"><span class="number">110616</span>  <span class="number">16</span>-<span class="number">08</span>-<span class="number">05</span> <span class="number">11</span>:<span class="number">54</span>:<span class="number">47</span></div><div class="line">parent here </div><div class="line"><span class="number">110614</span>  <span class="number">16</span>-<span class="number">08</span>-<span class="number">05</span> <span class="number">11</span>:<span class="number">54</span>:<span class="number">48</span></div><div class="line"><span class="number">110615</span>  <span class="number">16</span>-<span class="number">08</span>-<span class="number">05</span> <span class="number">11</span>:<span class="number">54</span>:<span class="number">48</span></div><div class="line">child here,my pid <span class="keyword">is</span> <span class="number">110617</span></div><div class="line"><span class="number">110617</span>  <span class="number">16</span>-<span class="number">08</span>-<span class="number">05</span> <span class="number">11</span>:<span class="number">54</span>:<span class="number">48</span></div><div class="line"><span class="number">110616</span>  <span class="number">16</span>-<span class="number">08</span>-<span class="number">05</span> <span class="number">11</span>:<span class="number">54</span>:<span class="number">48</span></div><div class="line"><span class="number">110614</span>  <span class="number">16</span>-<span class="number">08</span>-<span class="number">05</span> <span class="number">11</span>:<span class="number">54</span>:<span class="number">49</span></div><div class="line"><span class="number">110617</span>  <span class="number">16</span>-<span class="number">08</span>-<span class="number">05</span> <span class="number">11</span>:<span class="number">54</span>:<span class="number">49</span></div><div class="line"><span class="number">110616</span>  <span class="number">16</span>-<span class="number">08</span>-<span class="number">05</span> <span class="number">11</span>:<span class="number">54</span>:<span class="number">49</span></div><div class="line">[root@localhost default]# <span class="number">110617</span>    <span class="number">16</span>-<span class="number">08</span>-<span class="number">05</span> <span class="number">11</span>:<span class="number">54</span>:<span class="number">50</span></div><div class="line"><span class="number">110616</span>  <span class="number">16</span>-<span class="number">08</span>-<span class="number">05</span> <span class="number">11</span>:<span class="number">54</span>:<span class="number">50</span></div><div class="line"><span class="number">110617</span>  <span class="number">16</span>-<span class="number">08</span>-<span class="number">05</span> <span class="number">11</span>:<span class="number">54</span>:<span class="number">51</span></div><div class="line"><span class="number">110617</span>  <span class="number">16</span>-<span class="number">08</span>-<span class="number">05</span> <span class="number">11</span>:<span class="number">54</span>:<span class="number">52</span></div></pre></td></tr></table></figure>
<p>小结：创建了3个子进程，和父进程一起并行运行。但很容易因为两个进程同时进行写操作而造成冲突。</p>
<h3 id="什么是僵尸进程？如何避免？"><a href="#什么是僵尸进程？如何避免？" class="headerlink" title="什么是僵尸进程？如何避免？"></a>什么是僵尸进程？如何避免？</h3><p>子进程结束时，父进程没有等待它（通过调用wait或者waitpid）,那么子进程结束后不会释放所有资源（浪费呀！），这种进程被称为僵尸进程，他里面存放了子进程结束时的相关数据，如果僵尸进程过多，会占用大量系统资源（如内存），影响机器性能。<br>用直接方式，父进程创建了子进程后，并没有等待子进程结束，二十继续运行。似乎这里看不到有什么问题。如果php脚本并不是运行完后自动结束，而是常驻内存的，就会造成子进程无法回收的问题。也就是僵尸进程。可以通过pcntl_wai()方法等待进程结束，然后回收已经结束的进程。</p>
<h4 id="栗子再来一个"><a href="#栗子再来一个" class="headerlink" title="栗子再来一个"></a>栗子再来一个</h4><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">pcntl_signal(SIGCHLD, SIG_IGN); //如果父进程不关心子进程什么时候结束,子进程结束后，内核会回收。  </div><div class="line">$pid = pcntl_fork();  </div><div class="line"> if ($pid == -1)&#123;  </div><div class="line">      ...  </div><div class="line">&#125; else if ($pid &gt; 0)&#123;  </div><div class="line">       echo "parent continue \n";  </div><div class="line">       pcntl_wait($status);  //阻塞方式，多余并行有违初心</div><div class="line">       //pcntl_wait($status,WNOHANG); //如果不想要阻塞进程注释掉上一句，开启此句等待子进程中断，防止子进程成为僵尸进程。  </div><div class="line">       for ($k=0; $k&lt;2; ++$k)&#123;  </div><div class="line">            beep();  </div><div class="line">      &#125;  </div><div class="line">&#125; else if ($pid == 0)&#123;  </div><div class="line">       ...  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h3><p>通过pcntl_XXX系列函数使用多进程功能。注意：pcntl_XXX只能运行在php CLI（命令行）环境下，在web服务器环境下，会出现无法预期的结果，请慎用！<br>附加：进程之间如何通信？</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="//schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://7xiwze.com1.z0.glb.clouddn.com/50.jpg"
               alt="Tianhao" />
          <p class="site-author-name" itemprop="name">Tianhao</p>
          <p class="site-description motion-element" itemprop="description">终生学习者，实践者，践行渐远。</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">18</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/actorTian" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2013 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Tianhao</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.2"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.2"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"lamphao"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  

  

  

  

  


</body>
</html>
